
<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    
    <!-- ðŸš¨ CRITICAL PRODUCTION AUTH FIX - HEMEN YÃœKLENECEK -->
    <script>
      (function() {
        console.log('ðŸš¨ EMERGENCY AUTH FIX - Production Build');
        
        // Global fallback auth state
        window._emergencyAuthState = {
          user: null,
          loading: false,
          isAuthenticated: false,
          login: async (email, password) => {
            try {
              const response = await fetch('/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
              });
              
              if (response.ok) {
                const data = await response.json();
                window._emergencyAuthState = {
                  ...window._emergencyAuthState,
                  user: data.user,
                  isAuthenticated: true
                };
                localStorage.setItem('turklawai_token', data.token);
                return { success: true, user: data.user };
              }
              return { success: false, error: 'Login failed' };
            } catch (error) {
              return { success: false, error: error.message };
            }
          },
          logout: () => {
            window._emergencyAuthState = {
              ...window._emergencyAuthState,
              user: null,
              isAuthenticated: false
            };
            localStorage.removeItem('turklawai_token');
          },
          loginWithOAuth: (provider = 'google') => {
            window.location.href = `/api/auth/${provider}/login`;
          }
        };
        
        // Bundle error interception
        const originalError = console.error;
        console.error = function(...args) {
          const message = args[0];
          if (typeof message === 'string' && 
              message.includes('useSimpleAuth must be used within a SimpleAuthProvider')) {
            console.warn('ðŸ”§ AUTH ERROR INTERCEPTED - Using emergency fallback');
            return;
          }
          originalError.apply(console, args);
        };
        
        // Global useSimpleAuth hook override
        window.useSimpleAuth = () => {
          console.log('ðŸ”„ Emergency useSimpleAuth hook called');
          return window._emergencyAuthState;
        };
        
        // React Context setup when React loads
        const setupReactContext = () => {
          if (window.React && window.React.createContext) {
            window.SimpleAuthContext = window.React.createContext(window._emergencyAuthState);
            
            window.SimpleAuthProvider = ({ children }) => {
              return window.React.createElement(
                window.SimpleAuthContext.Provider,
                { value: window._emergencyAuthState },
                children
              );
            };
            
            console.log('âœ… Emergency React context created');
          }
        };
        
        // Bundle error handler
        window.addEventListener('error', (event) => {
          if (event.filename && event.filename.includes('index-') && 
              event.error && event.error.message && 
              event.error.message.includes('useSimpleAuth must be used within')) {
            
            console.error('ðŸš¨ BUNDLE AUTH ERROR CAUGHT:', event.error.message);
            event.preventDefault();
            event.stopPropagation();
            
            // Show user-friendly message
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
              position: fixed;
              top: 20px;
              right: 20px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 16px 20px;
              border-radius: 12px;
              box-shadow: 0 8px 25px rgba(0,0,0,0.2);
              z-index: 10000;
              max-width: 350px;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              font-size: 14px;
            `;
            messageDiv.innerHTML = \`
              <div style="font-weight: bold; margin-bottom: 8px;">
                ðŸ”§ TurkLawAI Sistemi GÃ¼ncelleniyor
              </div>
              <div style="font-size: 12px; opacity: 0.9; margin-bottom: 12px;">
                Hukuki araÅŸtÄ±rma sistemi optimize ediliyor. Sayfa otomatik yenilenecek.
              </div>
              <button onclick="window.location.reload()" style="
                background: rgba(255,255,255,0.2);
                border: 1px solid rgba(255,255,255,0.3);
                color: white;
                padding: 8px 16px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 12px;
              ">
                Åžimdi Yenile
              </button>
            \`;
            
            document.body.appendChild(messageDiv);
            
            // Auto reload after 3 seconds
            setTimeout(() => {
              window.location.reload();
            }, 3000);
            
            return false;
          }
        });
        
        // Initialize React context when available
        if (window.React) {
          setupReactContext();
        } else {
          const reactInterval = setInterval(() => {
            if (window.React) {
              setupReactContext();
              clearInterval(reactInterval);
            }
          }, 100);
          
          setTimeout(() => clearInterval(reactInterval), 5000);
        }
        
        console.log('âœ… Emergency auth fix initialized');
        
        // Debug helper
        window._authFixDebug = {
          state: () => window._emergencyAuthState,
          test: () => console.log('Auth fix working:', typeof window.useSimpleAuth === 'function'),
          reload: () => window.location.reload()
        };
      })();
    </script>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- PWA Theme Colors -->
    <meta name="theme-color" content="#1e40af" />
    <meta name="msapplication-TileColor" content="#1e40af" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="TurkLaw AI" />
    
    <!-- iOS Splash Screens -->
    <link rel="apple-touch-startup-image" href="/placeholder.svg" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/placeholder.svg" />
    
    <title>TurkLaw AI - TÃ¼rk Hukukunda AI Destekli AraÅŸtÄ±rma Platformu</title>
    <meta name="description" content="YargÄ±tay, DanÄ±ÅŸtay ve Emsal kararlarÄ±nÄ± saniyeler iÃ§inde bulun. 100,000+ karar, AI destekli analiz." />
    <meta name="author" content="TurkLaw AI" />
    <meta name="keywords" content="hukuk, yargÄ±tay, danÄ±ÅŸtay, emsal karar, ai, tÃ¼rk hukuku, hukuki araÅŸtÄ±rma" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Open Graph -->
    <meta property="og:title" content="TurkLaw AI - TÃ¼rk Hukukunda AI Destekli AraÅŸtÄ±rma Platformu" />
    <meta property="og:description" content="YargÄ±tay, DanÄ±ÅŸtay ve Emsal kararlarÄ±nÄ± saniyeler iÃ§inde bulun. 100,000+ karar, AI destekli analiz." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    <meta property="og:locale" content="tr_TR" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    
    <!-- Security - Updated CSP for WebSocket support -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https: wss: wss://*.supabase.co https://*.supabase.co; frame-src 'self';" />
    
    <!-- Performance -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//fonts.gstatic.com" />
    
    <!-- Accessibility -->
    <meta name="color-scheme" content="light dark" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Screen reader announcements -->
    <div id="sr-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    
    <!-- Emergency Auth Styles -->
    <style>
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
      
      /* Hide bundle errors from user */
      .error-boundary {
        background: transparent;
        border: none;
        padding: 0;
      }
      
      /* Loading state for auth fix */
      .auth-loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        color: #667eea;
        font-size: 16px;
      }
    </style>
  </body>
</html>
